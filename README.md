# Знакомство с GitHub Actions
## Общее описание
```text
    В GitHub Actions можно реализовать CI в процессе CI/CD.
    CI - Continuous Integration (непрерывная интеграция), CD - Continuous Delivery (непрерывная поставка); CD - как только push'ится код в репозиторий,
    мы раскатываем эти изменения на все среды автоматически.
    CI - набор практик, при которых в код вносятся небольшие изменения с частыми коммитами (максимально быстрые и короткие операции изменения,
    их проверки в репозитории линтерами и тестами, затем перенос на среды).
    В GitHub в разделе Actions присутствуют заготовки для типичных тестов, но так же можно и создать собственные, полностью описав их логику.
    Pylint - статический анализатор кода (так же есть Flake8), он позволяет проверять код на соответствие PEP8.
    Чтобы добавить новые проверки, можно использовать как добавление новых шагов/job'ов, так и создание дополнительных yaml-файлов для новых workflow.
    Для тестирования с помощью "pytest" приложения на "Flask", можно воспользоваться встроенным тестовым клиентом.
    !!! "conftest.py" - файл с таким именем автоматически распознаётся приложением Flask, как содержащий "fixture" !!!
    Чтобы исправить проблему с отсутствующим импортом для "pytest", чтобы проводить тестирование, можно либо добавить в общий файл, либо в "requirements-dev.txt".
```
## Ключевые элементы
```text
    01) cd .\cicd\      - создали и перешли в новую папку;
    02) git clone <http-ссылка>     - склонировать репозиторий по ссылке;
    03) git status      - просмотр текущего состояния проекта;
    04) git add     - добавление файлов в проект;
    05) git commit -m "<текст комментария для >"
    06) GitHub -> Actions -> Pylint     - создание 
    07) https://stackoverflow.com/questions/17659206/git-push-results-in-authentication-failed?page=1&tab=scoredesc#tab-top
        - решение проблемы с ошибкой аутентификации в Git; 
    08) https://docs.github.com/ru/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token     - генерация токена;
    pylint.yml
    09) name: Pylint    - имя Action'а;
    10) on: [push]      - на какое событие запускается данный Action;
    11) jobs:           - этапы, которые нужно пройти;
    12)     bild:       - сборка;
    13)         runs-on: ubuntu-latest      - на какой ОС/платформе запускается Action (Docker-образ), можно перенаправить на свой сервер;
    14)         strategy:                   - стратегия;
    15)             matrix:                 - матрица версий интерпретатора;
    16)                 python-version: ["3.8", "3.9", "3.10"]      - перечисление версий Python для запуска Action'а;
    17)         steps:      - шаги выполнения Action'а (build'а);
    18)         - uses: actions/checkout@3     - выводится определённая версия из матрицы, под которой запускается Action;
    19)         - name: Set up Python ${{ matrix.python-version }}      - имя шага с получением версии Python из матрицы;
    20)           uses: actions/setup-python@v3      - установка соответствующей версии Python;
    21)           with:
    22)             python-version: ${{ matrix.python-version }}        - получение версии Python из матрицы;
    23)           - name: Install dependencies      - установка зависимостей;
    24)             run: |      - основная команда, которую используем для выполнения любой команды на виртуальном сервере в Docker-образе;
    25)                 python -m pip install --upgrade pip     - обновляем pip;
    26)                 pip install pylint      - установка пакета "pylint";
    27)           - name: Analysing the code with pylint        - шаг анализа кода с линтером;
    28)             run: |      - запуск команды ниже;
    29)             pylint $(git ls-files '*.py')       - данная команда выполняет pylint для всех файлов под Git'ом, у которых расширение ".py";
    30) git pull        - обновить ветку из репозитория;
    31) pylint $(git ls-files '*.py')       - локальная проверка файлов с помощью линтера "Pylint";
    32) https://stackoverflow.com/questions/64059610/how-to-resolve-refusing-to-allow-an-oauth-app-to-create-or-update-workflow-on
        - решение проблемы с ошибкой " (refusing to allow a Personal Access Token to create or update workflow `";
    33) branches: [ "main" ]        - указание ветки, для которой запускается Action;
    34) if [ -f requirements.txt ]; then pip install -r requirements.txt; fi        - в случае наличие файла с зависимостями - установить их;
    35) pip install pytest      - установка "pytest";
    36) pytest      - запуск "pytest" локально;
    37) 
    38) 
    39) 
    40) 
    
```
## Шаги 
```text
    01) Создали новый репозиторий для проработки CI/CD с .gitignore (Python) и лицензией GNU;
    02) Создали новую папку и склонировали через командную строку созданный репозиторий по ссылке;
    03) Сконфигурировали новый интерпретатор (по всплывающему окошку в правом нижнем углу): Add New -> Local -> Virtual Env.;
    04) Скопировали код проекта из 22го урока и добавили в проект;
    05) В .gitignore добавили исключение ".idea";
    06) Добавили и закоммитили файлы в git командой в терминале;
    07) Запушили в репозиторий закоммиченные файлы через терминал (!!! для этого шага пришлось сгенерить токен !!!);
    08) Создали в разделе "Actions" новый Action "Pylint" со стандартными настройками и закоммитили его в репозиторий;
    09) Сразу запустился workflow и упал с ошибкой выполнения (множества не соответствий PEP8);
    10) Обновили локальную ветку файлов репозитория Git'а, подтянулся yaml-файл Action'а проверки с помсщью Pylint;
    11) Установили "Pylint" локально;
    12) Запустили команду проверки кода с помощью линтера "Pylint", получили множество ошибок в коде на несоответствие PEP8; 
    13) Доработали файлы с выявленными ошибками, попутно перезапуская проверку;
    14) После завершения правок и получения 10 балов из 10 проверки линтером, закоммитили изменения и запушили их в репозиторий;
    15) Проверка упала с ошибкой: "main.py:10:0: E0401: Unable to import 'flask' (import-error)" и
        "main.py:14:0: E0401: Unable to import 'werkzeug.exceptions' (import-error)" из-за проблем с установкой зависимостей;
    16) Добавили установку зависимостей из собранного ранее файла "requirements.txt" в список команд в yaml-файле;
    17) Закоммитили и запушили изменения в репозиторий;
    18) Workflow запустился автоматически и отработал успешно;
    19) Добавили новый Workflow "Python application", изменив стандартные настройки: переименовали файл, оставили только "pip install -r requirements.txt",
        убрали "name: Lint with flake8";
    20) Workflow запустился автоматически, первый тест отработал успешно, второй - упал с ошибкой "Error: Process completed with exit code 5.";
    21) Обновили локальную ветку, установили и запустили "pytest";
    22) Добавили новый пакет "testing" для набора тестов;
    23) Создали файл тестов "testing/test_main.py" и описали первый тест для функции;
    24) Создали файл с настройками тестирования "testing/conftest.py", настроили тестовый клиент через фикстуру;
    25) Провели локальное тестирование, тест прошёл успешно;
    26) Добавили генерацию рандомного значения для входного параметра URL-адреса, тест прошёл успешно;
    27) Провели проверку линтером и скорректировали код добавленных файлов по найденным несоответствиям PEP8;
    28) Закоммитили изменения и запушили их в репозиторий, проверка упала с ошибкой "Error: Process completed with exit code 5.";
    29) Добавили файл DEV-зависимостей "requirements-dev.txt" и внесли в него линтер "Pylint" и "pytest";
    30) 
    31) 
    32) 
    33) 
    34) 
    35) 
    36) 
    37) 
    38) 
    39) 
    40) 
    41) 
    42) 
```
